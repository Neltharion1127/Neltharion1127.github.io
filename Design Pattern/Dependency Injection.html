<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>依赖注入（Dependecy Injection） | Hello, World.</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="📦 🎨 A api-friendly theme for VuePress.">
    
    <link rel="preload" href="/assets/css/0.styles.3cb8d2af.css" as="style"><link rel="preload" href="/assets/js/app.a138196f.js" as="script"><link rel="preload" href="/assets/js/3.41a850e3.js" as="script"><link rel="preload" href="/assets/js/7.7fbe2fb6.js" as="script"><link rel="prefetch" href="/assets/js/1.134260ed.js"><link rel="prefetch" href="/assets/js/10.50679057.js"><link rel="prefetch" href="/assets/js/11.ed1e6b44.js"><link rel="prefetch" href="/assets/js/12.bc30df44.js"><link rel="prefetch" href="/assets/js/13.87fa51bf.js"><link rel="prefetch" href="/assets/js/14.c788a1df.js"><link rel="prefetch" href="/assets/js/15.ca69aec6.js"><link rel="prefetch" href="/assets/js/16.897362a8.js"><link rel="prefetch" href="/assets/js/17.88d9cfbe.js"><link rel="prefetch" href="/assets/js/18.7c60a920.js"><link rel="prefetch" href="/assets/js/19.b750c8b8.js"><link rel="prefetch" href="/assets/js/20.e04610fc.js"><link rel="prefetch" href="/assets/js/4.287a8ba3.js"><link rel="prefetch" href="/assets/js/5.d105af4a.js"><link rel="prefetch" href="/assets/js/6.a6d9a3c7.js"><link rel="prefetch" href="/assets/js/8.8035cd59.js"><link rel="prefetch" href="/assets/js/9.8a2b1b86.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3cb8d2af.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme__container"><div class="row"><div class="col-md-3 col-lg-2 sidebar__container"><div class="menu menu__container"><div class="menu__box"><a class="menu__btn"><div class="hamburger"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></a></div></div> <div class="sidebar" style="width:100%;display:none;"><div class="group"><div class="group__title">Search</div> <div class="group__body"><div class="search search__container"><div class="search__heading"><input type="text" value="" class="search__ipt"></div> <div class="search__body"><ul class="search__list" style="display:none;"><li class="search__item"><a href="/" class="router-link-active">Hello, World.</a></li><li class="search__item"><a href="/Design%20Pattern/Dependency%20Injection.html" aria-current="page" class="router-link-exact-active router-link-active">依赖注入（Dependecy Injection）</a></li><li class="search__item"><a href="/Design%20Pattern/Dependency%20Injection.html#依赖注入的概念了解">依赖注入的概念了解</a></li><li class="search__item"><a href="/Design%20Pattern/Dependency%20Injection.html#依赖注入的优点、实现">依赖注入的优点、实现</a></li><li class="search__item"><a href="/Design%20Pattern/Dependency%20Injection.html#小结">小结</a></li></ul></div></div></div></div> <!----> <div class="group"><div class="group__title">
      home
    </div> <div class="group__body"><div class="group__category category"><div class="category__label"><a href="/" class="category__link sidebar-link router-link-active">Hello, World.</a></div></div> <!----> <!----></div></div><div class="group"><div class="group__title">
      Design Pattern
    </div> <div class="group__body"><!----> <!----> <div><div class="group__category category category--selected"><div class="category__label"><a href="/Design%20Pattern/Dependency%20Injection.html" aria-current="page" class="category__link sidebar-link router-link-exact-active router-link-active">依赖注入（Dependecy Injection）</a></div> <div><div class="category__headers"><div class="category__header-item"><a href="/Design%20Pattern/Dependency%20Injection.html#依赖注入的概念了解" class="category__link sidebar-link">依赖注入的概念了解</a></div></div><div class="category__headers"><div class="category__header-item"><a href="/Design%20Pattern/Dependency%20Injection.html#依赖注入的优点、实现" class="category__link sidebar-link">依赖注入的优点、实现</a></div></div><div class="category__headers"><div class="category__header-item"><a href="/Design%20Pattern/Dependency%20Injection.html#小结" class="category__link sidebar-link">小结</a></div></div></div></div></div></div></div><div class="group"><div class="group__title">
      JavaScript
    </div> <div class="group__body"><!----> <!----> <div><div class="group__category category"><div class="category__label"><a href="/JavaScript/async%20function.html" class="category__link sidebar-link">Async函数</a></div> <!----></div><div class="group__category category"><div class="category__label"><a href="/JavaScript/OAuth%202%20code(authorization%20code).html" class="category__link sidebar-link">Oauth 2 Code实现单点登录(Authorization Code)</a></div> <div><div class="category__headers"><div class="category__header-item"><a href="/JavaScript/OAuth%202%20code(authorization%20code).html#_1-oauth2-单点的登录的实现逻辑-白话版" class="category__link sidebar-link">1.Oauth2 单点的登录的实现逻辑（白话版）</a></div></div><div class="category__headers"><div class="category__header-item"><a href="/JavaScript/OAuth%202%20code(authorization%20code).html#_2-具体代码-vue-router-guard" class="category__link sidebar-link">2.具体代码(Vue Router Guard)</a></div></div></div></div><div class="group__category category"><div class="category__label"><a href="/JavaScript/CommonJS.html" class="category__link sidebar-link">Commonjs</a></div> <div><div class="category__headers"><div class="category__header-item"><a href="/JavaScript/CommonJS.html#_1-概述" class="category__link sidebar-link">1.概述</a></div></div><div class="category__headers"><div class="category__header-item"><a href="/JavaScript/CommonJS.html#_2-module对象" class="category__link sidebar-link">2.Module对象</a></div></div><div class="category__headers"><div class="category__header-item"><a href="/JavaScript/CommonJS.html#_3-amd规范和commonjs规范的兼容性" class="category__link sidebar-link">3.Amd规范和Commonjs规范的兼容性</a></div></div><div class="category__headers"><div class="category__header-item"><a href="/JavaScript/CommonJS.html#_4-require命令" class="category__link sidebar-link">4.Require命令</a></div></div><div class="category__headers"><div class="category__header-item"><a href="/JavaScript/CommonJS.html#_5-模块的加载机制" class="category__link sidebar-link">5.模块的加载机制</a></div></div></div></div><div class="group__category category"><div class="category__label"><a href="/JavaScript/promise.html" class="category__link sidebar-link">Promise</a></div> <!----></div><div class="group__category category"><div class="category__label"><a href="/JavaScript/class.html" class="category__link sidebar-link">类构造函数</a></div> <div><div class="category__headers"><div class="category__header-item"><a href="/JavaScript/class.html#_1-实例化" class="category__link sidebar-link">1. 实例化</a></div></div><div class="category__headers"><div class="category__header-item"><a href="/JavaScript/class.html#_2-把类当成普通函数" class="category__link sidebar-link">2. 把类当成普通函数</a></div></div></div></div><div class="group__category category"><div class="category__label"><a href="/JavaScript/prototype.html" class="category__link sidebar-link">对象和原型</a></div> <!----></div><div class="group__category category"><div class="category__label"><a href="/JavaScript/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAnew.html" class="category__link sidebar-link">实现一个New</a></div> <!----></div><div class="group__category category"><div class="category__label"><a href="/JavaScript/prototypeChain.html" class="category__link sidebar-link">原型链</a></div> <!----></div><div class="group__category category"><div class="category__label"><a href="/JavaScript/%E7%BB%84%E5%90%88%E5%AF%84%E7%94%9F%E7%BB%A7%E6%89%BF.html" class="category__link sidebar-link">组合寄生继承</a></div> <!----></div><div class="group__category category"><div class="category__label"><a href="/JavaScript/%E9%98%B2%E6%8A%96%20%E8%8A%82%E6%B5%81.html" class="category__link sidebar-link">防抖 节流</a></div> <div><div class="category__headers"><div class="category__header-item"><a href="/JavaScript/%E9%98%B2%E6%8A%96%20%E8%8A%82%E6%B5%81.html#函数防抖" class="category__link sidebar-link">函数防抖</a></div></div><div class="category__headers"><div class="category__header-item"><a href="/JavaScript/%E9%98%B2%E6%8A%96%20%E8%8A%82%E6%B5%81.html#函数节流" class="category__link sidebar-link">函数节流</a></div></div></div></div></div></div></div><div class="group"><div class="group__title">
      Network
    </div> <div class="group__body"><!----> <!----> <div><div class="group__category category"><div class="category__label"><a href="/Network/%E8%BE%93%E5%85%A5%E4%B8%80%E4%B8%AAURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88.html" class="category__link sidebar-link">输入一个Url发生了什么</a></div> <div><div class="category__headers"><div class="category__header-item"><a href="/Network/%E8%BE%93%E5%85%A5%E4%B8%80%E4%B8%AAURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88.html#_1-有缓存" class="category__link sidebar-link">1.有缓存</a></div></div><div class="category__headers"><div class="category__header-item"><a href="/Network/%E8%BE%93%E5%85%A5%E4%B8%80%E4%B8%AAURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88.html#_2-浏览器查找域名的ip地址" class="category__link sidebar-link">2.浏览器查找域名的Ip地址</a></div></div><div class="category__headers"><div class="category__header-item"><a href="/Network/%E8%BE%93%E5%85%A5%E4%B8%80%E4%B8%AAURL%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88.html#_3-浏览器向web服务器发送一个http请求" class="category__link sidebar-link">3.浏览器向Web服务器发送一个HTTP请求</a></div></div></div></div></div></div></div><div class="group"><div class="group__title">
      Other
    </div> <div class="group__body"><!----> <!----> <div><div class="group__category category"><div class="category__label"><a href="/Other/WSL2.html" class="category__link sidebar-link">记录一次Wsl2搭建前端开发环境的过程</a></div> <div><div class="category__headers"><div class="category__header-item"><a href="/Other/WSL2.html#_1-安装wsl" class="category__link sidebar-link">1. 安装Wsl</a></div></div><div class="category__headers"><div class="category__header-item"><a href="/Other/WSL2.html#_2-修改软件源" class="category__link sidebar-link">2. 修改软件源</a></div></div><div class="category__headers"><div class="category__header-item"><a href="/Other/WSL2.html#_2-安装nodejs" class="category__link sidebar-link">2. 安装Nodejs</a></div></div><div class="category__headers"><div class="category__header-item"><a href="/Other/WSL2.html#_3-windows环境" class="category__link sidebar-link">3. Windows环境</a></div></div></div></div><div class="group__category category"><div class="category__label"><a href="/Other/Github%20fork.html" class="category__link sidebar-link">Github Fork</a></div> <!----></div></div></div></div></div></div> <div class="col-md-9 col-lg-10 content__container"><div class="page__container"><div custom="" class="content__default"><h1 id="依赖注入-dependecy-injection"><a href="#依赖注入-dependecy-injection" class="header-anchor">#</a> 依赖注入（Dependecy Injection）</h1> <h2 id="依赖注入的概念了解"><a href="#依赖注入的概念了解" class="header-anchor">#</a> 依赖注入的概念了解</h2> <p>介绍依赖注入（DI），首先要了解一个概念-即控制反转（Inversion of Control,IoC）。
控制反转是面向对象的一种设计原则，可以用来降低计算机代码之间的耦合度。在传统的应用程序中，都是程序员手动在类的内部创需要依赖的对象，而这种方式经常会导致类与类之间的高度耦合，难以测试。而当有了IoC容器之后，类把创建和查找依赖的权限都交给了容器，由容器进行注入组合对象，所以对象与对象之间是松散耦合，方便测试，同时也利用共呢个的复用和代码结构的灵活。</p> <p>DI(Dependecy Injection)，即“依赖注入”。IoC是一个很大的概念，可以用不同的方法实现。其主要的表现形式主要有两种，一种是依赖查找，另外一种就是依赖注入了，依赖注入即组建不做定位查询，只提供普通的Java方法让容器区决定依赖关系。容器全权负责组建的装配，它会把符合依赖关系的对象通过JavaBean属性或者构造函数传递给需要的对象。通过JavaBean属性银蛇依赖关系的方法称为设置方法注入（Setter Injection)；将依赖关系作为构造函数参数传入的做法成为构造器注入（Constructor Injection）。</p> <h2 id="依赖注入的优点、实现"><a href="#依赖注入的优点、实现" class="header-anchor">#</a> 依赖注入的优点、实现</h2> <p>在我们实际的生产中，任何一个应用都是由许多类组成，这些类之间按照协作来完成特定的业务逻辑。按照传统的方式，每个对象负责管理与自己相互协作的对象（即它所依赖的对象）的引用，这将会导致高度耦合和难以测试的代码。</p> <p>举个例子，下面代码中的Lecturer类，只能执行讲授高等数学课的任务。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lecturer</span> <span class="token keyword">implements</span> <span class="token class-name">Teacher</span> <span class="token punctuation">{</span>
        
    <span class="token keyword">private</span> <span class="token class-name">AdvancedMathematicsTask</span> task<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Lecturer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在这里与 MathLessonQeust紧耦合</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AdvancedMathematicsTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lectureLesson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        task<span class="token punctuation">.</span><span class="token function">lecture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>可以从上面的代码看出，lecture在构造函数中创建了AdvancedMathematicsTask，这使得Lecturer和AdvancedMathematicsTask紧密的耦合到了一起，因此极大的限制了这个讲师的授课能力，如果这学期需要一位讲授高等数据的老师，那么这位僵尸可以立即就任，但是如果开一门线性代数，或者统计学，那么这位讲师就爱莫能助了。</p> <p>更加糟糕的是，为这个Lecture编写单元测试的时候格外困难。在这样的代码中，你必须保证当僵尸的lectureLesson()方法被调用的时候，task的lecture方法也要被调用。但是没有一个简洁明了的方式能够实现这一点。很遗憾，Lecture将无法进行测试。</p> <p>而通过DI，对象的依赖关系由系统中负责协调各对象的第三方组件来创建对象的时候进行设定。对象无需自行创建或管理他们的依赖关系。</p> <p>下面我们通过代码，展示这一点。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Professor</span> <span class="token keyword">implements</span> <span class="token class-name">Teacher</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Task</span> task<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Professor</span><span class="token punctuation">(</span><span class="token class-name">Task</span> task<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Quest 被注入进来</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>task <span class="token operator">=</span> task<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
        
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lectureLesson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        task<span class="token punctuation">.</span><span class="token function">lecture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>  

</code></pre></div><p>从上面的代码，我们可以看到与之前的不同，Professor没有自行创建授课任务，而是在构造器中把授课任务作为参数传入。这是依赖注入的方式之一，即前面提到的构造器注入。</p> <p>更重要的是，传入的任务类型是Task，也就是所有的授课任务都必须实现同一个接口。所以，Professor可以响应AdvancedMathematicsTask，LinearALgebraTask、StatisticsTask等任意Task实现。</p> <p>这里的要点是Professor没有与任何特定的Task实现发生耦合，对它来说，被要求讲授的课只要实现了Task接口，那么具体是哪门课就无所谓了。这就是DI带来的最大收益--松耦合。如果一个对象值通过接口（而不是具体实现或初始化过程）来表明依赖关系，那么这种依赖就能够在对象本身毫不知情的情况下，用不同的具体实现进行替换。</p> <p>对依赖进行替换的一个最常用的方法就是在测试的时候使用mock实现。我们无法充分的测试Lecturer，因为它是紧耦合的；但是可以轻松的测试Professor，只需要给它一个Task的mock实现即可，如下面代码所示。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">Mockito</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProfessorText</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">ProfessorShouldLectureLesson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Task</span> mockTask <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">Task</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建 mock Task</span>
        <span class="token class-name">Professor</span> professor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Professor</span><span class="token punctuation">(</span>mockTask<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注入 mock Task</span>
        professor<span class="token punctuation">.</span><span class="token function">lectureLesson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>mockTask<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lecture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 验证mockTask实现的lecture()方法仅被调用一次</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>   

</code></pre></div><h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <p>DI是组装应用的一种方式，借助这种方式对象无需知道依赖来自何处或者依赖的实现方式。不同于自己获取依赖对象，对象会在运行期赋予他们所依赖的对象。以来对象会通过接口了解所注入的对象，这样的话就能确保低耦合。</p> <p>转载
https://www.cnblogs.com/jojop/p/11185738.html</p></div> <!----></div></div></div> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a138196f.js" defer></script><script src="/assets/js/3.41a850e3.js" defer></script><script src="/assets/js/7.7fbe2fb6.js" defer></script>
  </body>
</html>
